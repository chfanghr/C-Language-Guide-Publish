# Chapter25 宏定义

&emsp;&emsp;预处理命令可以改变程序设计环境,提高编程效率,它们并不是 C 语言本身的组成部分,不能直接对 它们进行编译,必须在对程序进行编译之前,先对程序中这些特殊的命令进行“预处理” .经过预处理后,程序就不再包括预处理命令了,最后再由编译程序对预处理之后的源程序进行编译处理,得到可供执行的 目标代码.C 语言提供的预处理功能有三种,分别为宏定义,文件包含和条件编译,下面将对它们进行简单介绍.<br>
&emsp;&emsp;在 C 语言源程序中允许用一个标识符来表示一个字符串,称为“宏” ,被定义为“宏”的标识符称为“宏名”.在编译预处理时,对程序中所有出现的宏名,都用宏定义中的字符串去代换,这称为“宏代换”或“宏展开”. 宏定义是由源程序中的宏定义命令完成的,宏代换是由预处理程序自动完成的.在 C 语言中,宏分为 有参数和无参数两种.无参宏的宏名后不带参数,其定义的一般形式为: 
```C
#define 标识符 字符串; 
```
&emsp;&emsp;其中`#`表示这是一条预处理命令(在 C 语言中凡是以`#`开头的均为预处理命令)`define`为宏定义命令,“标识符”为所定义的宏名, “字符串”可以是常数,表达式,格式串等.符号常量的定义就是一种无参宏定义. <br>
&emsp;&emsp;此外,常常对程序中反复使用的表达式进行宏定义.例如: 
```C
#define M (y*y+3*y);
```
&emsp;&emsp;它的作用是指定标识符 `M `来代替表达式`(y*y+3*y)`. <br>
&emsp;&emsp;在编写源程序时, 所有的`(y*y+3*y)`都可由 `M` 代替, 而对源程序进行编译时,将先由预处理程序进行宏代换,即用`(y*y+3*y)`表达式去置换所有的宏名 `M`,然后 再进行编译. <br>
&emsp;&emsp;C语言允许宏带有参数.在宏定义中的参数称为形式参数,在宏调用中的参数称为实际参数.对于带参数的宏,在调用中,不仅要宏展开,而且要用实参去代换形参. 
&emsp;&emsp;带参宏定义的一般形式为: 
```C
#define 宏名(形参表) 字符串; 
```
&emsp;&emsp;在字符串中含有各个形参. <br>
&emsp;&emsp;带参宏调用的一般形式为:
```C 
宏名(实参表); 
```
&emsp;&emsp;例如: 
```C
#define M(y) y*y+3*y
/*宏定义*/
...
k=M(5);
/*宏调用*/
... 
```
&emsp;&emsp;在上面的宏调用时,用实参`5`去代替形参`y`,经预处理宏展开后的语句为: 
```C
k=5*5+3*5;
``` 
&emsp;&emsp;下面的程序给出了一个宏定义和调用的完整实例. <br>
&emsp;&emsp;定义一个名为 MAX 的带参数的宏,可以通过它来选出参数 a,b 中的较大值. 

* [example:src/Chapter25.c](../src/Chapter25.c)
```C   
#include <stdio.h>
#define MAX(a,b) (a>b)?a:b
/*带参数的宏定义*/
main()
{
int x,y,max;
printf("input two numbers: ");
scanf("%d %d",&x,&y);
max=MAX(x,y);
printf("max=%d\n",max);
/*宏调用*/
}
```
&emsp;&emsp;程序运行结果如下: 
```sh
input two numbers: 2009 2010
max=2010
```
&emsp;&emsp;可以看到,宏替换相当于实现了一个函数调用的功能,而事实上,与函数调用相比,宏调用更能提高 
C程序的执行效率.